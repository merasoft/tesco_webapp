<div class="h-[calc(100vh-80px)] flex flex-col">
  <!-- Header -->
  <header class="bg-white border-b border-gray-100 p-4 sticky top-0 z-40" [ngClass]="{ 'pr-6': cartCount > 0 }">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4 flex-1">
        <button (click)="goBack()">
          <i class="pi pi-arrow-left text-lg"></i>
        </button>
        <div class="flex-1">
          <h2 class="text-lg text-center font-semibold">Ваша корзина</h2>
        </div>
      </div>

      <button (click)="goBack()">
        <i class="pi pi-shopping-bag text-xl" pBadge [value]="cartCount" [ngClass]="{ 'hidden-badge': !cartCount }"></i>
      </button>
    </div>
  </header>

  <!-- Delivery Info -->
  <div class="bg-blue-50 p-4 border-b border-gray-100">
    <div class="flex items-center justify-between gap-4">
      <span class="text-sm text-gray-600">Доставка в</span>
      <div class="w-[210px]">
        <p-select [options]="locations" [(ngModel)]="selectedLocation" optionLabel="name" styleClass="w-full" panelStyleClass="w-[210px]" (onChange)="onLocationChange($event.value)">
          <ng-template #selectedItem>
            <span class="text-sm font-medium text-gray-800">{{ selectedLocation?.name }}</span>
          </ng-template>
          <ng-template #item let-location>
            <span class="w-full truncate" [ngClass]="{ 'text-blue-500': location.isAddNew }">
              <i *ngIf="location.isAddNew" class="text-xs pi pi-plus mr-1"></i>
              {{ location.name }}
            </span>
          </ng-template>
        </p-select>
      </div>
    </div>
  </div>

  <!-- Cart Content -->
  <div class="flex-1 overflow-y-auto pb-4">
    <!-- Empty Cart State -->
    <div *ngIf="cartItems.length === 0" class="flex flex-col items-center justify-center min-h-[400px] text-center p-6">
      <i class="pi pi-shopping-cart text-6xl text-gray-400 mb-4"></i>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">Ваша корзина пуста</h3>
      <p class="text-gray-500 mb-6">Добавьте товары для начала</p>
      <button class="px-6 py-3 bg-blue-500 text-white rounded-lg font-medium border-0" (click)="goBack()"> Начать покупки </button>
    </div>

    <!-- Cart Items -->
    <div *ngIf="cartItems.length > 0" class="p-4 space-y-4">
      <div *ngFor="let item of cartItems" class="bg-white rounded-lg border border-gray-200 p-4">
        <div class="flex gap-4">
          <!-- Product Image -->
          <div class="w-20 h-20 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
            <img [src]="item.images && item.images[0] ? item.images[0] : ''" [alt]="item.name" class="w-full h-full object-cover" loading="lazy" />
          </div>

          <!-- Product Details -->
          <div class="flex-1 min-w-0">
            <div class="flex flex-col cursor-pointer" (click)="goToProduct(item.id)">
              <h3 class="font-semibold text-gray-900 text-sm leading-tight">{{ item.name }}</h3>
              <p *ngIf="item.selectedColor" class="text-xs text-gray-500 mt-1">Цвет: {{ item.selectedColor }}</p>
            </div>
            <p class="text-lg font-bold text-gray-900 mt-2">{{ item.price | numberFormat }} <span class="text-sm">сум</span></p>

            <div class="flex items-center gap-4 mt-1">
              <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden">
                <button (click)="updateQuantity(item.id, -1)" class="w-8 h-8 bg-transparent border-0 flex items-center justify-center">
                  <i class="pi pi-minus text-xs"></i>
                </button>
                <span class="px-3 text-center text-sm min-w-[2rem]">{{ item.quantity }}</span>
                <button (click)="updateQuantity(item.id, 1)" class="w-8 h-8 bg-transparent border-0 flex items-center justify-center">
                  <i class="pi pi-plus text-xs"></i>
                </button>
              </div>
              <button (click)="removeItem(item.id)" class="text-red-500 text-sm font-medium bg-transparent border-0 p-0">
                <i class="pi pi-trash text-xs mr-1"></i>
                Удалить
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Fixed Cart Footer -->
  <div *ngIf="cartItems.length > 0" class="bg-white border-t border-gray-200 p-4 space-y-3">
    <!-- Order Summary Header -->
    <h3 class="text-lg font-semibold text-gray-900">Сводка заказа</h3>

    <!-- Order Details -->
    <div class="flex items-center justify-between">
      <span class="text-lg text-gray-900">Итого</span>
      <span class="text-lg font-bold text-gray-900">{{ total | numberFormat }} <span class="text-base">сум</span></span>
    </div>

    <!-- Checkout Button -->
    <button class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold border-0" (click)="proceedToCheckout()"> Перейти к оформлению </button>
  </div>
</div>

<!-- Address Drawer -->
<app-address-drawer [(visible)]="showAddressDrawer" (addressSaved)="onAddressAdded($event)" (closed)="onDrawerClosed()"> </app-address-drawer>
