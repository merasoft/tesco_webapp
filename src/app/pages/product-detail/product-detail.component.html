<div>
  <!-- Header -->
  <header class="bg-white border-b border-gray-100 p-4">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4 flex-1">
        <button (click)="goBack()">
          <i class="pi pi-arrow-left text-lg"></i>
        </button>
        <div class="flex-1">
          <h2 class="text-lg text-center font-semibold">Details Product</h2>
        </div>
      </div>

      <button routerLink="/cart">
        <i class="pi pi-shopping-bag text-xl"></i>
      </button>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex items-center justify-center min-h-[400px]">
    <i class="pi pi-spinner text-4xl text-blue-500 animate-spin"></i>
  </div>

  <!-- Product Content -->
  <div *ngIf="!isLoading && product">
    <!-- Product Image Section -->
    <div class="flex flex-col gap-4">
      <!-- Main Image Carousel -->
      <div class="h-80 relative">
        <img *ngIf="product.images && product.images.length === 1" [src]="product.images[0]" [alt]="product.name" class="w-full h-full object-cover" />
        <p-carousel
          *ngIf="product.images && product.images.length > 1"
          [value]="product.images"
          [numVisible]="1"
          [numScroll]="1"
          [circular]="true"
          [showNavigators]="true"
          [showIndicators]="false"
          class="product-carousel"
          styleClass="h-full"
          [page]="selectedImageIndex"
          (onPage)="onCarouselPageChange($event)">
          <ng-template pTemplate="item" let-image>
            <div class="h-full flex items-center justify-center">
              <img [src]="image" [alt]="product.name" class="h-full w-full object-cover" loading="lazy" />
            </div>
          </ng-template>
        </p-carousel>
      </div>

      <!-- Thumbnail Images Gallery -->
      <div class="thumbnail-images flex gap-2 px-4 overflow-x-auto overflow-y-hidden pb-1" *ngIf="product.images && product.images.length > 1">
        <button
          *ngFor="let image of product.images; let i = index"
          (click)="selectImage(i)"
          class="prod-image-button flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all"
          [ngClass]="{
            'border-gray-200': i !== selectedImageIndex,
            'active border-blue-500': i === selectedImageIndex
          }">
          <img [src]="image" [alt]="'Product image ' + (i + 1)" class="w-full h-full object-cover" />
        </button>
      </div>
    </div>

    <!-- Product Info Section -->
    <div class="relative p-6">
      <!-- Product Header -->
      <div class="flex justify-between items-start mb-6">
        <div class="flex-1">
          <h1 class="text-xl font-semibold mb-2">{{ product.name }}</h1>
          <div class="flex items-center gap-4 mb-2">
            <p class="text-2xl font-bold text-gray-900">{{ product.price | numberFormat }} sum</p>
            <p *ngIf="product.oldPrice" class="text-lg text-gray-500 line-through">{{ product.oldPrice | numberFormat }} sum</p>
          </div>
          <p class="text-sm text-gray-500">{{ product.buyCount }} people bought this</p>
        </div>
        <button class="p-3 rounded-full border-0 bg-transparent cursor-pointer" (click)="toggleFavorite()">
          <i [class]="isFavorite ? 'pi pi-heart-fill text-red-500 text-2xl' : 'pi pi-heart text-gray-400 text-2xl'"></i>
        </button>
      </div>

      <!-- Rating Display -->
      <div *ngIf="product.rating" class="flex items-center gap-2 mb-6">
        <div class="flex items-center gap-0.5">
          <span *ngFor="let star of getStarArray(product.rating)" class="text-base relative">
            <!-- Full Star -->
            <i *ngIf="star === 'full'" class="pi pi-star-fill text-yellow-400"></i>
            <!-- Half Star -->
            <span *ngIf="star === 'half'" class="inline-block relative">
              <i class="pi pi-star-half-fill text-yellow-400"></i>
              <i class="pi pi-star-half-fill text-gray-300 absolute top-0 left-0 transform scale-x-[-1]"></i>
            </span>
            <!-- Empty Star -->
            <i *ngIf="star === 'empty'" class="pi pi-star-fill text-gray-300"></i>
          </span>
        </div>
        <span class="text-sm text-gray-500 ml-1">({{ product.rating }})</span>
      </div>

      <!-- Color Selection -->
      <div *ngIf="product.colors && product.colors.length > 0" class="mb-6">
        <h3 class="text-base font-semibold mb-3">Choose the color</h3>
        <div class="flex gap-3">
          <div
            *ngFor="let color of product.colors"
            class="w-12 h-12 rounded-full cursor-pointer border-4 transition-all"
            [class.border-blue-500]="selectedColor === color"
            [class.border-transparent]="selectedColor !== color"
            [style.background-color]="color"
            (click)="selectColor(color)">
          </div>
        </div>
      </div>

      <!-- Seller Section -->
      <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg mb-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
            <i class="pi pi-building text-white text-xl"></i>
          </div>
          <div>
            <p class="font-semibold text-gray-900">{{ product.seller }}</p>
            <p class="text-sm text-gray-500">online 12 mins ago</p>
          </div>
        </div>
        <button class="px-6 py-2 bg-white border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors font-medium"> Follow </button>
      </div>

      <!-- Description -->
      <div class="mb-6">
        <h3 class="text-base font-semibold mb-3">Description</h3>
        <p class="text-gray-600 leading-relaxed">{{ product.description }}</p>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-3 pt-4">
        <button class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors border-0 cursor-pointer" (click)="addToCart()">
          <i class="mr-2 pi pi-shopping-cart"></i>
          Add to Cart
        </button>
        <button class="flex-1 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition-colors border-0 cursor-pointer" (click)="buyNow()">
          <i class="mr-2 pi pi-credit-card"></i>
          Buy Now
        </button>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !product" class="flex flex-col items-center justify-center min-h-[400px] text-center p-6">
    <i class="pi pi-exclamation-triangle text-6xl text-gray-400 mb-4"></i>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">Product Not Found</h3>
    <p class="text-gray-500 mb-4">The product you're looking for doesn't exist or has been removed.</p>
    <button class="px-6 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors border-0 cursor-pointer" (click)="goBack()"> Back to Products </button>
  </div>
</div>
