<div>
  <!-- Header -->
  <header class="bg-white border-b border-gray-100 p-4">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4 flex-1">
        <button (click)="goBack()">
          <i class="pi pi-arrow-left text-lg"></i>
        </button>
        <div class="flex-1">
          <h2 class="text-lg text-center font-semibold">Details Product</h2>
        </div>
      </div>

      <button routerLink="/cart">
        <i class="pi pi-shopping-bag text-xl" pBadge [value]="cartCount" [ngClass]="{ 'hidden-badge': !cartCount }"></i>
      </button>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex items-center justify-center min-h-[400px]">
    <i class="pi pi-spinner text-4xl text-blue-500 animate-spin"></i>
  </div>

  <!-- Product Content -->
  <div *ngIf="!isLoading && product">
    <!-- Product Image Section -->
    <div class="flex flex-col gap-4 mb-2">
      <!-- Main Image Carousel -->
      <div class="h-80 relative">
        <img *ngIf="product.images && product.images.length === 1" [src]="product.images[0]" [alt]="product.name" class="w-full h-full object-cover" />
        <p-carousel
          *ngIf="product.images && product.images.length > 1"
          [value]="product.images"
          [numVisible]="1"
          [numScroll]="1"
          [circular]="true"
          [showNavigators]="true"
          [showIndicators]="false"
          class="product-carousel"
          styleClass="h-full"
          [page]="selectedImageIndex"
          (onPage)="onCarouselPageChange($event)">
          <ng-template pTemplate="item" let-image>
            <div class="h-full flex items-center justify-center">
              <img [src]="image" [alt]="product.name" class="h-full w-full object-cover" loading="lazy" />
            </div>
          </ng-template>
        </p-carousel>
      </div>

      <!-- Thumbnail Images Gallery -->
      <div *ngIf="product.images && product.images.length > 1" class="thumbnail-images flex gap-2 px-4 overflow-x-auto overflow-y-hidden">
        <button
          *ngFor="let image of product.images; let i = index"
          (click)="selectImage(i)"
          class="prod-image-button flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all"
          [ngClass]="{
            'border-gray-200': i !== selectedImageIndex,
            'active border-blue-500': i === selectedImageIndex
          }">
          <img [src]="image" [alt]="'Product image ' + (i + 1)" class="w-full h-full object-cover" />
        </button>
      </div>
    </div>

    <!-- Product Info Section -->
    <div class="p-4">
      <!-- Product Header -->
      <div class="flex flex-col">
        <div class="flex justify-between gap-4 mb-4 pb-2 border-b border-gray-200">
          <div class="flex flex-col">
            <h1 class="text-xl font-semibold mb-1">{{ product.name }}</h1>

            <!-- Rating Display -->
            <div *ngIf="product.rating" class="flex items-center gap-2">
              <div class="flex items-center gap-0.5">
                <span *ngFor="let star of getStarArray(product.rating)" class="text-base relative">
                  <!-- Full Star -->
                  <i *ngIf="star === 'full'" class="pi pi-star-fill text-yellow-400"></i>
                  <!-- Half Star -->
                  <span *ngIf="star === 'half'" class="inline-block relative">
                    <i class="pi pi-star-half-fill text-yellow-400"></i>
                    <i class="pi pi-star-half-fill text-gray-300 absolute top-1 left-0 transform scale-x-[-1]"></i>
                  </span>
                  <!-- Empty Star -->
                  <i *ngIf="star === 'empty'" class="pi pi-star-fill text-gray-300"></i>
                </span>
              </div>
              <span class="text-sm text-gray-500 ml-1">({{ product.rating }})</span>
            </div>
          </div>

          <button class="w-10 h-10 bg-gray-100 border-0 rounded-full" (click)="toggleFavorite()">
            <i
              class="pi text-xl"
              [ngClass]="{
                'pi-heart text-gray-500': !isFavorite,
                'pi-heart-fill text-red-500': isFavorite
              }"></i>
          </button>
        </div>

        <div class="flex flex-col gap-2">
          <div class="flex flex-col">
            <p class="text-2xl leading-none font-bold text-gray-900">
              {{ product.price | numberFormat }} <span class="text-lg">sum</span>
              <span *ngIf="product.buyCount" class="ml-2 text-sm text-gray-500 font-normal">({{ product.buyCount }} times bought)</span>
            </p>
            <p *ngIf="product.oldPrice" class="text-lg text-gray-500 line-through">{{ product.oldPrice | numberFormat }} sum</p>
          </div>
        </div>
      </div>

      <!-- Color Selection -->
      <div *ngIf="product.colors && product.colors.length > 0" class="mt-4">
        <h3 class="text-base font-semibold mb-3">Choose the color</h3>
        <div class="flex gap-3">
          <div
            *ngFor="let color of product.colors"
            class="w-12 h-12 rounded-full border-2 transition-all"
            [ngClass]="{
              'border-blue-500': selectedColor === color,
              'border-gray-200': selectedColor !== color
            }"
            [style.background-color]="color"
            (click)="selectColor(color)">
          </div>
        </div>
      </div>

      <!-- Description -->
      <div class="mb-8 border-t border-gray-200 pt-6 mt-6">
        <h3 class="text-base font-semibold mb-3">Description</h3>
        <p class="text-gray-600 leading-relaxed">{{ product.description }}</p>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col gap-3">
        <div class="flex items-stretch gap-4">
          <button (click)="quantity == 0 && addToCart()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2 border-0">
            <i *ngIf="quantity == 0" class="pi pi-shopping-cart"></i>
            <i *ngIf="quantity > 0" class="pi pi-check"></i>
            <span *ngIf="quantity == 0">Add to Cart</span>
            <span *ngIf="quantity > 0">In Cart</span>
          </button>
          <div *ngIf="quantity > 0" class="flex items-center border border-gray-300 rounded-lg overflow-hidden">
            <button (click)="decreaseQuantity()" class="w-10 h-full bg-transparent border-0">
              <i class="pi pi-minus text-sm"></i>
            </button>
            <span class="px-2 text-center">{{ quantity }}</span>
            <button (click)="increaseQuantity()" class="w-10 h-full bg-transparent border-0">
              <i class="pi pi-plus text-sm"></i>
            </button>
          </div>
        </div>
        <button class="flex-1 py-3 bg-blue-500 text-white rounded-lg font-semibold border-0" (click)="buyNow()">
          <i class="mr-2 pi pi-credit-card"></i>
          Buy Now
        </button>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !product" class="flex flex-col items-center justify-center min-h-[400px] text-center p-6">
    <i class="pi pi-exclamation-triangle text-6xl text-gray-400 mb-4"></i>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">Product Not Found</h3>
    <p class="text-gray-500 mb-4">The product you're looking for doesn't exist or has been removed.</p>
    <button class="px-6 py-2 bg-blue-500 text-white rounded-lg font-medium transition-colors border-0" (click)="goBack()"> Back to Products </button>
  </div>
</div>
