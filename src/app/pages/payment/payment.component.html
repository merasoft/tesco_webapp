<div class="h-[calc(100vh-80px)] flex flex-col">
  <!-- Header -->
  <header class="bg-white border-b border-gray-100 p-4 sticky top-0 z-40" [ngClass]="{ 'pr-6': cartCount > 0 }">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4 flex-1">
        <button (click)="goBack()">
          <i class="pi pi-arrow-left text-lg"></i>
        </button>
        <div class="flex-1">
          <h2 class="text-lg text-center font-semibold">Оплата</h2>
        </div>
      </div>

      <button routerLink="/cart">
        <i class="pi pi-shopping-bag text-xl" pBadge [value]="cartCount" [ngClass]="{ 'hidden-badge': !cartCount }"></i>
      </button>
    </div>
  </header>

  <!-- Content -->
  <div class="flex-1 overflow-y-auto">
    <!-- Payment Methods Section -->
    <div class="bg-white p-4">
      <h3 class="text-base font-semibold text-gray-900 mb-4">Выберите способ оплаты</h3>

      <div class="space-y-3">
        <div
          *ngFor="let method of paymentMethods"
          class="flex items-center justify-between p-4 border rounded-lg cursor-pointer"
          [ngClass]="{ 'border-blue-500 bg-blue-50': selectedPaymentMethod === method.id, 'border-gray-200': selectedPaymentMethod !== method.id }"
          (click)="selectPaymentMethod(method.id)">
          <div class="flex items-center gap-3">
            <div
              class="w-4 h-4 rounded-full border-2 flex items-center justify-center"
              [ngClass]="{ 'border-blue-500': selectedPaymentMethod === method.id, 'border-gray-300': selectedPaymentMethod !== method.id }">
              <div *ngIf="selectedPaymentMethod === method.id" class="w-2 h-2 bg-blue-500 rounded-full"></div>
            </div>
            <i class="pi text-gray-600" [ngClass]="method.icon"></i>
            <span class="font-medium text-gray-900">{{ method.name }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Card Details Section (shown when card is selected) -->
    <div *ngIf="selectedPaymentMethod === 'card'" class="bg-white p-4 mt-4">
      <h3 class="text-base font-semibold text-gray-900 mb-4">Данные карты</h3>

      <!-- Existing Card -->
      <div class="mb-4">
        <h4 class="text-sm font-medium text-gray-700 mb-2">Выберите существующую карту</h4>
        <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
          <div class="flex items-center gap-3">
            <i class="pi pi-credit-card text-gray-600"></i>
            <span class="text-sm text-gray-900">{{ cardNumber }}</span>
          </div>
          <i class="pi pi-trash text-red-500 cursor-pointer"></i>
        </div>
      </div>

      <!-- Or Add New Card -->
      <div class="mb-4">
        <div class="flex items-center justify-center my-4">
          <div class="flex-grow border-t border-gray-200"></div>
          <span class="px-4 text-sm text-gray-500">Или добавить новую карту</span>
          <div class="flex-grow border-t border-gray-200"></div>
        </div>
      </div>

      <!-- New Card Form -->
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Номер карты</label>
          <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="1234 5678 9012 3456" />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Срок действия</label>
            <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ММ/ГГ" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">CVV</label>
            <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="123" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Имя держателя карты</label>
          <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Иван Иванов" />
        </div>
      </div>
    </div>
  </div>

  <!-- Fixed Footer -->
  <div class="bg-white border-t border-gray-200 p-4 space-y-4">
    <!-- Order Summary -->
    <div class="space-y-2">
      <div class="flex items-center justify-between">
        <span class="text-sm text-gray-600">Общая сумма</span>
        <span class="text-sm font-medium text-gray-900">{{ total | numberFormat }} сум</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-sm text-gray-600">Доставка</span>
        <span class="text-sm font-medium text-gray-900 capitalize">{{ deliveryOption }} доставка</span>
      </div>
      <hr class="my-2" />
      <div class="flex items-center justify-between">
        <span class="text-lg font-semibold text-gray-900">Итого</span>
        <span class="text-xl font-bold text-gray-900">{{ total | numberFormat }} <span class="text-base">сум</span></span>
      </div>
    </div>

    <!-- Place Order Button -->
    <button class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold border-0" (click)="processPayment()"> Оформить заказ </button>
  </div>
</div>

<!-- Success Modal -->
<div *ngIf="showSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl p-6 max-w-sm w-full text-center" (click)="$event.stopPropagation()">
    <button class="absolute top-4 right-4 text-gray-400" (click)="closeModal()">
      <i class="pi pi-times text-lg"></i>
    </button>

    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <i class="pi pi-check text-2xl text-green-600"></i>
    </div>

    <h2 class="text-xl font-bold text-gray-900 mb-2">Оплата прошла успешно!</h2>
    <p class="text-gray-600 mb-6">Ваш заказ был успешно оформлен. Вы получите подтверждение на электронную почту в ближайшее время.</p>

    <div class="flex items-center justify-center gap-3 p-3 bg-gray-50 rounded-lg mb-6">
      <i class="pi pi-file-pdf text-red-500"></i>
      <span class="text-sm font-medium text-gray-900">Скачать чек</span>
      <i class="pi pi-download text-gray-500"></i>
    </div>

    <button class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold border-0" (click)="closeModal()"> Продолжить покупки </button>
  </div>
</div>
